# Inserting an entity

```csharp
public static void Insert(this IDbConnection connection, object entity, IDbTransaction transaction = null, Dialect dialect = null, int? commandTimeout = null)
```

Inserts an entity into the table.

:memo: You can insert any entity with this method, regardless of the type of primary key. However, you will not be able to retrieve the primary key so you should pre-generate it if necessary.

```csharp
public static TPrimaryKey Insert<TPrimaryKey>(this IDbConnection connection, object entity, IDbTransaction transaction = null, Dialect dialect = null, int? commandTimeout = null)
```

Inserts an entity into the table and returns it's generated identity.

:warning: Only primary keys of Int32 and Int64 (`int` and `long`) type are supported, since only those are generated by the database. For all other types of primary key, pre-generate the key and use `Insert(entity)`.

### Examples

##### Inserting an entity with an identity key
```csharp
[Table("Users")]
public class UserEntity
{
    public int Id { get; set; }
    public string Name { get; set; }
}

...

var entity = new UserEntity { Name = "Little bobby tables" };
entity.Id = this.connection.Insert<int>(entity);
```

<details>
<summary>MS-SQL 2012 +</summary>
```SQL
INSERT INTO [Users] ([Name])
VALUES (@Name);
SELECT CAST(SCOPE_IDENTITY() AS BIGINT) AS [id]
```
</details>
<details>
<summary>PostgreSQL</summary>
```SQL
INSERT INTO Users (Name)
VALUES (@Name);
SELECT LASTVAL() AS id
```
</details>

##### Inserting an entity with a pregenerated key

```csharp
[Table("Users")]
public class UserEntity
{
    [DatabaseGenerated(DatabaseGeneratedOption.None)]
    public Guid Id { get; set; }
    public string Name { get; set; }
}

...

var entity = new UserEntity { Id = Guid.NewGuid(), Name = "Little bobby tables" };
this.connection.Insert(entity);
```

<details>
<summary>MS-SQL 2012 +</summary>
```SQL
INSERT INTO [Users] ([Id], [Name])
VALUES (@Id, @Name);
```
</details>
<details>
<summary>PostgreSQL</summary>
```SQL
INSERT INTO Users (Id, Name)
VALUES (@Id, @Name);
```
</details>

##### Inserting an entity with a composite key

```csharp
[Table("Users")]
public class UserEntity
{
	[Key]
    [DatabaseGenerated(DatabaseGeneratedOption.None)]
	public string FirstName { get; set; }

	[Key]
    [DatabaseGenerated(DatabaseGeneratedOption.None)]
	public string LastName { get; set; }

	public int Age { get; set; }
}

...

var entity = new UserEntity { FirstName = "Bobby", LastName = "Drop-Tables", Age = 4 };
this.connection.Insert(entity);
```

<details>
<summary>MS-SQL 2012 +</summary>
```SQL
INSERT INTO [Users] ([FirstName], [LastName], [Name])
VALUES (@FirstName, @LastName, @Name);
```
</details>
<details>
<summary>PostgreSQL</summary>
```SQL
INSERT INTO Users (FirstName, LastName, Name)
VALUES (@FirstName, @LastName, @Name);
```
</details>

<a id="InsertRange"></a>
# Inserting multiple entities

```csharp
public static SqlCommandResult InsertRange<TEntity>(this IDbConnection connection, IEnumerable<TEntity> entities, IDbTransaction transaction = null, Dialect dialect = null, int? commandTimeout = null)
```

Efficiently inserts multiple entities.

:memo: for performance, it is recommended to wrap all bulk actions in a transaction.

```csharp
public static void InsertRange<TEntity, TPrimaryKey>(this IDbConnection connection, IEnumerable<TEntity> entities, Action<TEntity, TPrimaryKey> setPrimaryKey, IDbTransaction transaction = null, Dialect dialect = null, int? commandTimeout = null)
```

Efficiently inserts multiple entities, and for each one calls an action allowing its identity to be recorded.

:memo: for performance, it is recommended to wrap all bulk actions in a transaction.

:warning: Only primary keys of Int32 and Int64 (`int` and `long`) type are supported, since only those are generated by the database. For all other types of primary key, pre-generate the keys and use `InsertRange<TEntity>(entities)`.


##### Inserting an entity with an identity key
```csharp
[Table("Users")]
public class UserEntity
{
    public int Id { get; set; }
    public string Name { get; set; }
}

...

var entities = new []
    {
        new User { Name = "Little bobby tables" },
        new User { Name = "Jimmy" };
    };

using (var transaction = this.connection.BeginTransaction())
{
    this.connection.InsertRange<User, int>(entities, (e, k) => { e.Id = k; }, transaction);

    transaction.Commit();
}
```

<details>
<summary>MS-SQL 2012 +</summary>
```SQL
INSERT INTO [Users] ([Name])
VALUES (@Name);
SELECT CAST(SCOPE_IDENTITY() AS BIGINT) AS [id]
```
</details>
<details>
<summary>PostgreSQL</summary>
```SQL
INSERT INTO Users (Name)
VALUES (@Name);
SELECT LASTVAL() AS id
```
</details>

##### Inserting an entity with a pregenerated key

```csharp
[Table("Users")]
public class UserEntity
{
    [DatabaseGenerated(DatabaseGeneratedOption.None)]
    public Guid Id { get; set; }
    public string Name { get; set; }
}

...

var entities = new []
    {
        new User { Id = Guid.NewGuid(), Name = "Little bobby tables" },
        new User { Id = Guid.NewGuid(), Name = "Jimmy" }
    };

using (var transaction = this.connection.BeginTransaction())
{
    this.connection.InsertRange(entities, transaction);

    transaction.Commit();
}
```

<details>
<summary>MS-SQL 2012 +</summary>
```SQL
INSERT INTO [Users] ([Id], [Name])
VALUES (@Id, @Name);
```
</details>
<details>
<summary>PostgreSQL</summary>
```SQL
INSERT INTO Users (Id, Name)
VALUES (@Id, @Name);
```
</details>

##### Inserting an entity with a composite key

```csharp
[Table("Users")]
public class UserEntity
{
	[Key]
    [DatabaseGenerated(DatabaseGeneratedOption.None)]
	public string FirstName { get; set; }

	[Key]
    [DatabaseGenerated(DatabaseGeneratedOption.None)]
	public string LastName { get; set; }

	public int Age { get; set; }
}

...

var entity = new UserEntity { FirstName = "Bobby", LastName = "Drop-Tables", Age = 4 };
this.connection.Insert(entity);


var entities = new []
    {
        new User { FirstName = "Bobby", LastName = "Drop-Tables", Age = 4 },
        new User { FirstName = "Jimmy", LastName = "Little", Age = 6 }
    };

using (var transaction = this.connection.BeginTransaction())
{
    this.connection.InsertRange(entities, transaction);

    transaction.Commit();
}

```

<details>
<summary>MS-SQL 2012 +</summary>
```SQL
INSERT INTO [Users] ([FirstName], [LastName], [Name])
VALUES (@FirstName, @LastName, @Name);
```
</details>
<details>
<summary>PostgreSQL</summary>
```SQL
INSERT INTO Users (FirstName, LastName, Name)
VALUES (@FirstName, @LastName, @Name);
```
</details>